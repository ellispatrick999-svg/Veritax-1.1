# AI Design Documentation

**Version:** 1.0  
**Date:** January 10, 2026  

This document describes the design of the AI components in the AI Tax Engine, including reasoning, NLP parsing, inference, rule routing, context building, and explanation generation. It also covers integration with the tax engine, safety, and advisory modules.

---

## 1. Overview

The AI subsystem is responsible for:

- Interpreting user queries in natural language  
- Applying tax rules to user-specific data  
- Generating safe, personalized advice  
- Producing explanations for reasoning steps  
- Integrating with the tax engine, safety, and advisor modules  

The system is **modular, extensible, and audit-ready**.

---

## 2. Component Structure

**Directory:** `backend/reasoning/`

- `reasoner.py` – Orchestrates AI reasoning  
- `nlp_parser.py` – Converts natural language into structured queries  
- `inference_engine.py` – Applies tax and business rules to structured data  
- `rule_router.py` – Directs queries to appropriate modules (tax, safety, advisor)  
- `context_builder.py` – Maintains user-specific session context  
- `explanation_generator.py` – Produces human-readable reasoning

---

### 2.1 Reasoner (`reasoner.py`)

- Orchestrates AI reasoning for a user query  
- Sequence:
  1. NLP parsing → structured representation  
  2. Rule routing → determines which modules to consult (tax engine, safety, advisor)  
  3. Inference → applies tax/business rules to user data  
  4. Context update → stores session-specific knowledge  
  5. Explanation → generates human-readable reasoning  

---

### 2.2 NLP Parser (`nlp_parser.py`)

- Converts natural language queries into structured forms  
- Functions:
  - Entity recognition (income, deductions, credits)  
  - Intent classification (calculate tax, suggest strategies, explain rules)  
  - Question normalization (e.g., "How much can I deduct for 2026 home office?")  

---

### 2.3 Inference Engine (`inference_engine.py`)

- Applies rules to structured data from NLP parser  
- Types of rules:
  - Tax rules (brackets, deductions, credits)  
  - Business rules (self-employment, passive losses)  
  - Safety rules (risk scoring, compliance checks)  
- Supports chaining of rules and dependencies  

---

### 2.4 Rule Router (`rule_router.py`)

- Directs queries to the appropriate subsystem:
  - Tax Engine (`tax_engine`) → for calculations  
  - Safety Engine (`safety`) → for risk evaluation  
  - Advisor (`advisor`) → for recommendations  
- Ensures rules are applied in the correct order with appropriate context  

---

### 2.5 Context Builder (`context_builder.py`)

- Maintains session-specific context for each user  
- Tracks:
  - Previously asked questions  
  - Current filing status and income info  
  - Applied deductions and credits  
  - AI reasoning steps for continuity  
- Enables **multi-turn conversations**  

---

### 2.6 Explanation Generator (`explanation_generator.py`)

- Produces **human-readable reasoning** for:
  - Tax calculations  
  - Safety or compliance flags  
  - Recommended strategies  
- Helps users understand why advice was given  
- Logs explanations for audit purposes  

---

## 3. Integration with Tax Engine

- The AI system relies on `tax_engine` for:
  - Brackets, deductions, credits  
  - Filing status rules  
  - Business and depreciation rules  
  - Audit flags  
- Ensures **CPA-grade accuracy** while AI handles reasoning and personalization  

---

## 4. Safety & Compliance Integration

- AI queries are cross-checked by:
  - `safety_checks.py` → validates deductions and credits  
  - `compliance.py` → ensures IRS rules are followed  
  - `risk_scoring.py` → flags high-risk or unusual entries  
  - `escalation.py` → forwards uncertain cases for human review  

- All flagged items include **explanations** generated by AI  

---

## 5. Advisor Integration

- Recommendations are generated by:
  - `strategy_engine.py` → determines tax-saving strategies  
  - `recommendation_engine.py` → selects appropriate, safe actions  
- AI ensures recommendations:
  - Follow IRS rules  
  - Fit user context (income, filing status, deductions)  
  - Are explained clearly to users  

---

## 6. Key AI Principles

1. **Accuracy** – Uses CPA-grade tax engine for calculations  
2. **Safety** – All outputs checked by safety and compliance modules  
3. **Transparency** – Explanation generator logs reasoning  
4. **Extensibility** – Modular design allows new rules, strategies, or NLP models  
5. **Auditability** – All reasoning steps are logged for review  

---

## 7. Notes

- Multi-turn queries supported via context builder  
- AI reasoning is **stateless per session**, but context allows continuity  
- Integration ensures AI does **not bypass safety or tax rules**  

---

**End of Document**


